{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/xmvl/Documents/d919/components/spectrum-analyzer/RingLevelizer.tsx"],"sourcesContent":["\"use client\";\n\nimport React, { useEffect, useState, useRef } from \"react\";\nimport { parseAndSortPaths } from \"@/lib/svg-utils\";\n\nexport interface RingConfig {\n  rotationSpeed: number;\n  numSets: number;\n  setSize: number;\n  litColor: string;\n  dimColor: string;\n  direction: 1 | -1;\n}\n\ninterface RingLevelizerProps {\n  src: string;\n  config: RingConfig;\n  width?: string | number;\n  height?: string | number;\n  debug?: boolean;\n}\n\nexport const RingLevelizer: React.FC<RingLevelizerProps> = ({\n  src,\n  config,\n  width = \"100%\",\n  height = \"100%\",\n  debug = false,\n}) => {\n  const [paths, setPaths] = useState<string[]>([]);\n  const [offset, setOffset] = useState(0);\n  const [status, setStatus] = useState<\"loading\" | \"success\" | \"error\" | \"empty\">(\"loading\");\n  const [errorMessage, setErrorMessage] = useState<string>(\"\");\n\n  const requestRef = useRef<number>();\n  const prevTimeRef = useRef<number>();\n\n  // 位置調整用（134x117の中心）\n  const VIEW_BOX = \"0 0 134 117\";\n  const CENTER = { x: 67, y: 58.5 };\n\n  // 1. SVG読み込み\n  useEffect(() => {\n    const loadSvg = async () => {\n      try {\n        setStatus(\"loading\");\n        const res = await fetch(src);\n        if (!res.ok) throw new Error(`HTTP ${res.status}: ${res.statusText}`);\n        const text = await res.text();\n\n        const sorted = parseAndSortPaths(text, CENTER);\n\n        if (sorted.length === 0) {\n          setStatus(\"empty\");\n        } else {\n          setPaths(sorted);\n          setStatus(\"success\");\n        }\n      } catch (e: any) {\n        console.error(e);\n        setStatus(\"error\");\n        setErrorMessage(e.message);\n      }\n    };\n    loadSvg();\n  }, [src]);\n\n  // 2. アニメーション\n  const animate = (time: number) => {\n    if (prevTimeRef.current !== undefined) {\n      setOffset((prev) => {\n        const next = prev + config.direction * config.rotationSpeed;\n        if (paths.length > 0) {\n          if (next >= paths.length) return next - paths.length;\n          if (next < 0) return next + paths.length;\n        }\n        return next;\n      });\n    }\n    prevTimeRef.current = time;\n    requestRef.current = requestAnimationFrame(animate);\n  };\n\n  useEffect(() => {\n    if (status === \"success\") {\n      requestRef.current = requestAnimationFrame(animate);\n    }\n    return () => {\n      if (requestRef.current) cancelAnimationFrame(requestRef.current);\n    };\n  }, [status, config.rotationSpeed, config.direction, paths.length]);\n\n  // 3. 点灯判定\n  const isLit = (index: number) => {\n    if (paths.length === 0) return false;\n    const total = paths.length;\n    const currentBase = Math.floor(offset) % total;\n    const dist = Math.floor(total / config.numSets);\n\n    for (let i = 0; i < config.numSets; i++) {\n      const start = (currentBase + i * dist) % total;\n      let rel = index - start;\n      if (rel < 0) rel += total;\n      if (rel < config.setSize) return true;\n    }\n    return false;\n  };\n\n  // 表示ロジック（エラー時の表示を追加）\n  if (status === \"error\") {\n    return (\n      <div className=\"w-full h-full flex items-center justify-center bg-red-900/20 border border-red-500 text-red-500 text-[10px] p-2\">\n        Load Error: {errorMessage}\n      </div>\n    );\n  }\n\n  if (status === \"empty\") {\n    return (\n      <div className=\"w-full h-full flex flex-col items-center justify-center bg-gray-900 border border-yellow-500 text-yellow-500 text-[10px] p-2\">\n        <p>SVG Loaded but 0 paths found.</p>\n        <p>Check console for details.</p>\n      </div>\n    );\n  }\n\n  if (status === \"loading\") {\n    return (\n      <div className=\"w-full h-full flex items-center justify-center bg-gray-900 text-gray-500 text-[10px]\">\n        Loading SVG...\n      </div>\n    );\n  }\n\n  return (\n    <div style={{ width, height, position: \"relative\" }}>\n      <svg\n        width=\"100%\"\n        height=\"100%\"\n        viewBox={VIEW_BOX}\n        style={{ overflow: \"visible\" }}\n      >\n        {/* デバッグモード: 赤枠と中心線を表示 */}\n        {debug && (\n          <g pointerEvents=\"none\">\n            <rect x=\"0\" y=\"0\" width=\"134\" height=\"117\" fill=\"none\" stroke=\"red\" strokeWidth=\"0.5\" />\n            <line x1={CENTER.x} y1=\"0\" x2={CENTER.x} y2=\"117\" stroke=\"#0f0\" strokeWidth=\"0.5\" />\n            <line x1=\"0\" y1={CENTER.y} x2=\"134\" y2={CENTER.y} stroke=\"#0f0\" strokeWidth=\"0.5\" />\n          </g>\n        )}\n\n        <g>\n          {paths.map((d, i) => (\n            <path\n              key={i}\n              d={d}\n              fill={isLit(i) ? config.litColor : config.dimColor}\n              stroke=\"none\"\n              style={{ transition: \"fill 0.05s linear\" }}\n            />\n          ))}\n        </g>\n      </svg>\n      \n      {/* デバッグ情報: パス数 */}\n      {debug && (\n        <div className=\"absolute bottom-0 right-0 bg-black/80 text-white text-[9px] p-1\">\n          Cells: {paths.length}\n        </div>\n      )}\n    </div>\n  );\n};"],"names":[],"mappings":"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"}},
    {"offset": {"line": 255, "column": 0}, "map": {"version":3,"sources":["file:///Users/xmvl/Documents/d919/app/page.tsx"],"sourcesContent":["\"use client\";\n\nimport React from \"react\";\n// 作成したコンポーネントをインポート\nimport { RingLevelizer } from \"@/components/spectrum-analyzer/RingLevelizer\";\n\nexport default function Home() {\n  return (\n    <main className=\"flex min-h-screen flex-col items-center justify-center bg-black p-12\">\n      \n      <h1 className=\"text-cyan-400 text-2xl mb-8\">Levelizer Test</h1>\n\n      {/* ここに配置します */}\n      <div className=\"w-[400px] h-[400px] border border-gray-800 bg-gray-900 flex items-center justify-center\">\n        \n        <RingLevelizer \n          src=\"/images/masks/ring-level7.svg\" \n          config={{\n            rotationSpeed: 0.2,\n            numSets: 2,\n            setSize: 5,\n            litColor: \"#00FFFF\",\n            dimColor: \"#222222\", // 背景色に合わせて調整してください\n            direction: 1\n          }}\n          debug={true} // ★ここをtrueにすると赤い枠が出ます\n        />\n\n      </div>\n      \n      <p className=\"text-gray-500 mt-4 text-sm\">\n        赤枠の中にセルが表示され、回転していれば成功です。<br/>\n        確認できたら debug=&#123;false&#125; にしてください。\n      </p>\n    </main>\n  );\n}"],"names":[],"mappings":";;;;;AAGA,oBAAoB;AACpB;AAJA;;;AAMe,SAAS;IACtB,qBACE,8OAAC;QAAK,WAAU;;0BAEd,8OAAC;gBAAG,WAAU;0BAA8B;;;;;;0BAG5C,8OAAC;gBAAI,WAAU;0BAEb,cAAA,8OAAC,qKAAa;oBACZ,KAAI;oBACJ,QAAQ;wBACN,eAAe;wBACf,SAAS;wBACT,SAAS;wBACT,UAAU;wBACV,UAAU;wBACV,WAAW;oBACb;oBACA,OAAO;;;;;;;;;;;0BAKX,8OAAC;gBAAE,WAAU;;oBAA6B;kCACf,8OAAC;;;;;oBAAI;;;;;;;;;;;;;AAKtC"}},
    {"offset": {"line": 327, "column": 0}, "map": {"version":3,"sources":["file:///Users/xmvl/Documents/d919/node_modules/next/src/server/route-modules/app-page/vendored/ssr/react-jsx-dev-runtime.ts"],"sourcesContent":["module.exports = (\n  require('../../module.compiled') as typeof import('../../module.compiled')\n).vendored['react-ssr']!.ReactJsxDevRuntime\n"],"names":["module","exports","require","vendored","ReactJsxDevRuntime"],"mappings":"AAAAA,OAAOC,OAAO,GACZC,QAAQ,4HACRC,QAAQ,CAAC,YAAY,CAAEC,kBAAkB","ignoreList":[0]}}]
}